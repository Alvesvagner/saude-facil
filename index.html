<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sa√∫de F√°cil ‚Äî Portal</title>
  <meta name="author" content="Daniel / Prot√≥tipo Sa√∫de F√°cil" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1: #0077b6; --bg2:#00b4d8; --bg3:#90e0ef; --accent:#06d6a0; --card:#ffffff;
      --muted: #6b7280; --danger: #e63946; --glass: rgba(255,255,255,0.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:#04333a}
    body{
      background: linear-gradient(135deg,var(--bg1),var(--bg2) 45%,var(--accent) 90%);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow-x:hidden;
    }

    /* NAV */
    header{
      position:fixed;left:0;right:0;top:0;z-index:120;
      display:flex;align-items:center;justify-content:space-between;
      padding:10px 20px;background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      backdrop-filter: blur(6px);
      border-bottom:1px solid rgba(255,255,255,0.06);
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:100px;height:100px
      }
    .brand h1{margin:0;font-size:18px;color:#fff}
    nav{display:flex;gap:18px;align-items:center}
    nav a{color:rgba(255,255,255,0.95);text-decoration:none;font-weight:600;padding:8px 10px;border-radius:8px;transition:all .18s}
    nav a:hover{background:rgba(255,255,255,0.06);transform:translateY(-2px)}

    /* Layout */
    main{padding-top:84px;max-width:1150px;margin:0 auto}
    section{padding:64px 20px;min-height:60vh}
    .hero{display:flex;gap:28px;align-items:center;justify-content:space-between}
    .hero-left{max-width:640px;color:#fff}
    .eyebrow{display:inline-block;background:rgba(255,255,255,0.12);padding:6px 10px;border-radius:999px;font-weight:600;margin-bottom:14px}
    h2{font-size:36px;margin:12px 0 8px;line-height:1.05}
    p.lead{font-size:16px;color:rgba(255,255,255,0.92);margin-bottom:18px}
    .cta-row{display:flex;gap:12px;flex-wrap:wrap}
    .btn{
      background:linear-gradient(90deg,#00b4d8,#06d6a0);border:0;color:#04333a;padding:12px 18px;border-radius:12px;font-weight:700;cursor:pointer;
      box-shadow:0 10px 24px rgba(6,214,160,0.14);transition:transform .14s,box-shadow .14s;
    }
    .btn:hover{transform:translateY(-4px)}
    .btn-outline{background:transparent;color:#fff;border:1px solid rgba(255,255,255,0.14);box-shadow:none}

    /* hero right preview */
    .preview{
      width:420px;min-height:320px;background:linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
      border-radius:16px;padding:18px;color:#042b2d;box-shadow:0 10px 30px rgba(2,6,23,0.28);
      display:flex;flex-direction:column;gap:12px;backdrop-filter: blur(6px);
    }
    .preview .num{font-weight:700;color:#fff;background:rgba(0,0,0,0.18);padding:6px 10px;border-radius:10px;align-self:flex-start}
    .preview .mini-chat{background:#fff;border-radius:12px;padding:10px;flex:1;overflow:auto}
    .mini-msg{background:#e9fbf6;padding:8px 10px;border-radius:10px;margin:8px 0;max-width:78%}
    .mini-msg.user{background:#90e0ef;color:#052325;margin-left:auto}

    /* Sections */
    .grid{display:grid;grid-template-columns:1fr 380px;gap:24px;align-items:start}
    @media(max-width:980px){.grid{grid-template-columns:1fr}.preview{display:none}}

    /* Cards */
    .card{background:var(--card);border-radius:12px;padding:16px;color:#04333a;box-shadow:0 10px 30px rgba(2,6,23,0.08)}
    .section-title{font-size:20px;margin:0 0 12px;font-weight:700;color:#042b2d}

    /* Atendimento (chat page) */
    .chat-page{display:flex;gap:20px;flex-direction:column}
    .chat-main{display:flex;gap:18px}
    .chat-window{flex:1;display:flex;flex-direction:column;height:520px;background:linear-gradient(180deg,#f7feff,#ecffff);border-radius:12px;padding:12px;overflow:hidden}
    .messages{flex:1;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:8px}
    .msg{max-width:78%;padding:10px 12px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
    .msg.bot{background:#ffffff;align-self:flex-start}
    .msg.user{background:linear-gradient(90deg,var(--bg2),var(--accent));color:#042b2d;align-self:flex-end}
    .chat-controls{display:flex;gap:8px;padding-top:8px}
    .input{flex:1;padding:12px;border-radius:10px;border:1px solid #e6eef8}
    .small{font-size:13px;color:var(--muted)}

    /* Orienta√ß√µes cards */
    .cards{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media(max-width:700px){.cards{grid-template-columns:1fr}}

    .card.icon{display:flex;gap:12px;align-items:flex-start}
    .icon-box{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff}

    /* Hospitals */
    .hosp-list{display:flex;flex-direction:column;gap:8px}
    .hosp-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:linear-gradient(90deg,#f7fffb,#f2fff9)}

    /* Noticias */
    .news-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media(max-width:900px){.news-grid{grid-template-columns:1fr}}

    .news-card{padding:12px;border-radius:10px;background:linear-gradient(180deg,#ffffff,#f6fffb)}

    /* Footer */
    footer{margin-top:30px;padding:24px;text-align:center;color:rgba(255,255,255,0.9)}

    /* animations */
    .fade-in{opacity:0;transform:translateY(10px);animation:fadeIn .6s forwards}
    @keyframes fadeIn{to{opacity:1;transform:none}}

    /* utilities */
    .muted{color:var(--muted)}
    .danger{background:var(--danger);color:#fff;padding:8px 10px;border-radius:8px}
  </style>
</head>
<body>

  <header>
    <div class="brand">
      <div class="brand">
        <div class="logo">
          <img src="logo.png" class="logo" alt="logo do Sa√∫de f√°cil">
        </div>
¬†¬†¬†¬†¬†¬†¬†¬†</div>
      </div>
      <div>
        <h1>Sa√∫de F√°cil</h1>
        <div class="small" style="color:rgba(255,255,255,0.9)">Portal ‚Äî Atendimento r√°pido e orienta√ß√£o</div>
      </div>
    </div>

    <nav>
      <a href="#inicio">In√≠cio</a>
      <a href="#atendimento">Atendimento Virtual</a>
      <a href="#orientacoes">Orienta√ß√µes</a>
      <a href="#hospitais">Hospitais Pr√≥ximos</a>
      <a href="#noticias">Not√≠cias</a>
      <a href="#servicos">Servi√ßos</a>
      <a href="#contato">Contato</a>
    </nav>
  </header>

  <main>
    <!-- HERO / IN√çCIO -->
    <section id="inicio" class="hero">
      <div class="hero-left fade-in" style="animation-delay:.05s">
        <div class="eyebrow">Prot√≥tipo Acad√™mico</div>
        <h2>Resposta r√°pida em emerg√™ncias ‚Äî orienta√ß√£o e triagem para quem precisa.</h2>
        <p class="lead">Plataforma projetada para orientar o cidad√£o em primeiros socorros, realizar triagem b√°sica e facilitar o acionamento do servi√ßo 190 com dados e localiza√ß√£o.</p>
        <div class="cta-row">
          <button class="btn" onclick="scrollToSection('atendimento')">Atendimento Virtual</button>
          <button class="btn btn-outline" onclick="scrollToSection('orientacoes')">Ver orienta√ß√µes r√°pidas</button>
          <button class="btn btn-outline" onclick="getHospitals()">Hospitais perto de mim</button>
        </div>
      </div>

      <div class="preview fade-in" style="animation-delay:.12s">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="num">Sa√∫de F√°cil</div>
          <div style="font-size:13px;color:rgba(0,0,0,0.45)">Prot√≥tipo ¬∑ 2025</div>
        </div>

        <div class="mini-chat card" aria-hidden>
          <div class="mini-msg">Ol√°! Precisa de ajuda? ‚Üµ Responda "sim" para iniciar triagem.</div>
          <div class="mini-msg user">Sim</div>
          <div class="mini-msg">Voc√™ est√° consciente? (sim / n√£o)</div>
        </div>

        <div style="display:flex;gap:8px;margin-top:10px">
          <div class="card" style="flex:1;text-align:center">
            <div style="font-weight:700">Acionar 190</div>
            <div class="small muted">Liga√ß√£o r√°pida</div>
            <button class="btn" style="margin-top:10px;background:#ff6b6b;color:#fff" onclick="window.location.href='tel:190'">Ligar 190</button>
          </div>
          <div class="card" style="width:124px;text-align:center">
            <div style="font-weight:700">Guia</div>
            <div class="small muted">Inc√™ndio ¬∑ Engasgo</div>
            <button class="btn btn-outline" style="margin-top:10px" onclick="scrollToSection('orientacoes')">Abrir</button>
          </div>
        </div>
      </div>
    </section>

    <!-- ATENDIMENTO VIRTUAL -->
    <section id="atendimento" class="fade-in" style="background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));border-radius:18px;margin:10px 20px;padding:26px">
      <div class="section-title">Atendimento Virtual</div>
      <div style="display:flex;gap:18px;flex-wrap:wrap">
        <div class="card" style="flex:1;min-width:320px">
          <h3 style="margin-top:0">Chat de Triagem</h3>
          <p class="muted">Converse com o assistente para triagem inicial. Em casos de risco imediato, ligue para 190.</p>

          <div class="chat-page" id="chatPage">
            <div class="chat-window" id="chatWindow" role="log" aria-live="polite">
              <div class="messages" id="messages">
                <!-- mensagens aparecem aqui -->
              </div>
              <div style="border-top:1px solid rgba(2,6,23,0.04);padding-top:8px" class="chat-controls">
                <input id="userText" class="input" placeholder="Digite sua mensagem (ex: sim / n√£o / engasgo)" />
                <button class="btn" id="sendBtn">Enviar</button>
                <button class="btn btn-outline" id="clearBtn" title="Limpar conversa">Limpar</button>
              </div>
            </div>

            <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
              <button class="btn btn-outline" onclick="quick('Sim')">Est√° consciente?</button>
              <button class="btn btn-outline" onclick="quick('N√£o')">Respira?</button>
              <button class="btn btn-outline" onclick="quick('Sangramento')">Sangramento</button>
              <button class="btn btn-outline" onclick="quick('Engasgo')">Engasgo</button>
            </div>

          </div>
        </div>

        <aside style="width:320px">
          <div class="card">
            <h4 style="margin:0 0 8px">Resumo do Protocolo</h4>
            <pre id="protocolBox" style="white-space:pre-wrap;background:linear-gradient(180deg,#f7fffb,#f0fffb);padding:12px;border-radius:8px;min-height:140px">Nenhuma triagem iniciada.</pre>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn" id="copyProtocol">Copiar resumo</button>
              <button class="btn" style="background:#ffd166" id="sendTo190">Enviar para 190</button>
            </div>
            <div style="margin-top:12px" class="small muted">O envio para 190 aqui √© simulado ‚Äî em dispositivos m√≥veis o bot√£o liga para o n√∫mero.</div>
          </div>

          <div style="height:12px"></div>

          <div class="card">
            <h4 style="margin:0 0 8px">Localiza√ß√£o</h4>
            <div id="locInfo" class="small muted">Local n√£o obtido</div>
            <div style="margin-top:8px;display:flex;gap:8px">
              <button class="btn btn-outline" id="getLocBtn">Obter localiza√ß√£o</button>
              <button class="btn" id="manualLocBtn">Inserir endere√ßo</button>
            </div>
          </div>
        </aside>
      </div>
    </section>

    <!-- ORIENTA√á√ïES -->
    <section id="orientacoes" class="fade-in" style="margin:10px 20px;padding:22px">
      <div class="section-title">Orienta√ß√µes de Emerg√™ncia (r√°pidas)</div>
      <div class="card">
        <div class="cards">
          <div class="card icon">
            <div class="icon-box" style="background:linear-gradient(90deg,#ff9a9e,#fecfef)">üî•</div>
            <div>
              <h4 style="margin:4px 0">Inc√™ndio</h4>
              <div class="small muted">Afaste pessoas, chame o corpo de bombeiros (193) e s√≥ tente apagar pequenos focos com extintor se for seguro.</div>
            </div>
          </div>

          <div class="card icon">
            <div class="icon-box" style="background:linear-gradient(90deg,#80ed99,#bce784)">ü§ê</div>
            <div>
              <h4 style="margin:4px 0">Engasgo</h4>
              <div class="small muted">Se a v√≠tima estiver consciente e tossindo forte, incentive a tosse. Se n√£o respirar, inicie manobras de desobstru√ß√£o e RCP se necess√°rio.</div>
            </div>
          </div>

          <div class="card icon">
            <div class="icon-box" style="background:linear-gradient(90deg,#a0c4ff,#bdb2ff)">üíâ</div>
            <div>
              <h4 style="margin:4px 0">Sangramento</h4>
              <div class="small muted">Comprima diretamente o local, eleve o membro se poss√≠vel e mantenha press√£o at√© a chegada do socorro.</div>
            </div>
          </div>

          <div class="card icon">
            <div class="icon-box" style="background:linear-gradient(90deg,#ffd6a5,#fdffb6)">üß†</div>
            <div>
              <h4 style="margin:4px 0">Suspeita de AVC / Infarto</h4>
              <div class="small muted">Mantenha a v√≠tima em repouso, n√£o oferecer alimentos/√°gua, observe sinais de assimetria facial e dificuldade na fala. Acione emerg√™ncia.</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- HOSPITAIS -->
    <section id="hospitais" class="fade-in" style="margin:10px 20px;padding:22px">
      <div class="section-title">Hospitais Pr√≥ximos</div>
      <div class="card">
        <p class="small muted">Clique em "Hospitais perto de mim" para permitir localiza√ß√£o e abrir o mapa com hospitais pr√≥ximos (Google Maps / OpenStreetMap).</p>
        <div style="display:flex;gap:8px;margin-bottom:8px">
          <button class="btn" onclick="getHospitals()">Hospitais perto de mim</button>
          <button class="btn btn-outline" onclick="openMapWithQuery('hospitais')">Buscar no mapa (manualmente)</button>
        </div>

        <div id="hospList" class="hosp-list muted">Nenhuma busca realizada ainda.</div>
      </div>
    </section>

    <!-- NOT√çCIAS -->
    <section id="noticias" class="fade-in" style="margin:10px 20px;padding:22px">
      <div class="section-title">Not√≠cias e Dicas</div>
      <div class="news-grid">
        <div class="news-card card">
          <h4>Como agir em queimaduras</h4>
          <p class="small muted">Em queimaduras pequenas, resfrie com √°gua corrente por 10‚Äì20 minutos. N√£o aplique pomadas caseiras. Em queimadura extensa, acione o servi√ßo de emerg√™ncia.</p>
        </div>
        <div class="news-card card">
          <h4>Preven√ß√£o de acidentes dom√©sticos</h4>
          <p class="small muted">Mantenha objetos cortantes fora do alcance de crian√ßas, fixe tapetes e n√£o deixe cabos soltos.</p>
        </div>
        <div class="news-card card">
          <h4>Primeiros socorros: RCP b√°sica</h4>
          <p class="small muted">Se a v√≠tima estiver inconsciente e n√£o respirar normalmente, iniciar compress√µes tor√°cicas (30:2) ou compress√µes cont√≠nuas at√© chegada do socorro.</p>
        </div>
        <div class="news-card card">
          <h4>Cuidados com desmaios</h4>
          <p class="small muted">Deite a pessoa e eleve as pernas. Afrouxe roupas apertadas e verifique sinais vitais. Se persistir, buscar atendimento.</p>
        </div>
      </div>
    </section>

    <!-- SERVI√áOS -->
    <section id="servicos" class="fade-in" style="margin:10px 20px;padding:22px">
      <div class="section-title">Servi√ßos √öteis</div>
      <div class="card" style="display:flex;flex-direction:column;gap:10px">
        <div style="display:flex;flex-wrap:wrap;gap:10px">
          <div class="card" style="flex:1;min-width:220px">
            <strong>Pol√≠cia / Emerg√™ncia</strong><div class="muted">190</div>
            <button class="btn" style="margin-top:8px" onclick="window.location.href='tel:190'">Ligar 190</button>
          </div>
          <div class="card" style="flex:1;min-width:220px">
            <strong>Ambul√¢ncia (SAMU)</strong><div class="muted">192</div>
            <button class="btn" style="margin-top:8px" onclick="window.location.href='tel:192'">Ligar 192</button>
          </div>
          <div class="card" style="flex:1;min-width:220px">
            <strong>Bombeiros</strong><div class="muted">193</div>
            <button class="btn" style="margin-top:8px" onclick="window.location.href='tel:193'">Ligar 193</button>
          </div>
        </div>

        <div class="small muted">Lista de n√∫meros r√°pidos para situa√ß√µes diferentes ‚Äî voc√™ pode editar/expandir conforme a localidade.</div>
      </div>
    </section>

    <!-- CONTATO -->
    <section id="contato" class="fade-in" style="margin:10px 20px;padding:22px">
      <div class="section-title">Contato</div>
      <div class="card" style="display:flex;gap:18px;flex-wrap:wrap">
        <div style="flex:1;min-width:260px">
          <h4>Fale conosco</h4>
          <p class="small muted">Para sugest√µes e valida√ß√µes cl√≠nicas (simula√ß√£o acad√™mica): contato@saudefacil.exemplo</p>
          <form id="contactForm" onsubmit="event.preventDefault(); alert('Formul√°rio simulado ‚Äî pronto para enviar (apenas demonstra√ß√£o).')">
            <div style="display:flex;gap:8px;margin-bottom:8px">
              <input required placeholder="Nome" style="flex:1;padding:10px;border-radius:8px;border:1px solid #e6eef8" />
              <input required placeholder="E-mail" style="flex:1;padding:10px;border-radius:8px;border:1px solid #e6eef8" />
            </div>
            <textarea required placeholder="Mensagem" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef8;min-height:100px"></textarea>
            <div style="margin-top:8px">
              <button class="btn" type="submit">Enviar mensagem</button>
            </div>
          </form>
        </div>
        <div style="width:320px" class="card">
          <h4 style="margin-top:0">Redes</h4>
          <p class="small muted">@saudefacil (simulado) ‚Äî conte√∫do educativo e preven√ß√£o.</p>
          <h4 style="margin-bottom:6px">Nota</h4>
          <p class="small muted">Este √© um prot√≥tipo acad√™mico. Integra√ß√£o real com centrais de emerg√™ncia exige protocolos oficiais, valida√ß√£o regulat√≥ria e parceria com servi√ßos locais.</p>
        </div>
      </div>
    </section>

    <footer>
      ¬© 2025 Sa√∫de F√°cil ‚Äî Prot√≥tipo Acad√™mico ‚Ä¢ Desenvolvido por Daniel
    </footer>
  </main>

  <script>
    // Smooth scroll helper
    function scrollToSection(id){
      const el = document.getElementById(id);
      if(!el) return;
      const top = el.getBoundingClientRect().top + window.pageYOffset - 72;
      window.scrollTo({top,behavior:'smooth'});
    }

    /* ------------------------------
       Chatbot: fluxo simples e gen√©rico
       - coleta: iniciou?, nome, telefone, local (gps/manual), tipo de ocorr√™ncia
       - gera protocolo e exibe no painel lateral
    -------------------------------*/
    const messagesEl = document.getElementById('messages');
    const userInput = document.getElementById('userText');
    const sendBtn = document.getElementById('sendBtn');
    const clearBtn = document.getElementById('clearBtn');
    const protocolBox = document.getElementById('protocolBox');
    const copyProtocol = document.getElementById('copyProtocol');
    const sendTo190 = document.getElementById('sendTo190');
    const getLocBtn = document.getElementById('getLocBtn');
    const manualLocBtn = document.getElementById('manualLocBtn');
    const locInfo = document.getElementById('locInfo');
    const hospList = document.getElementById('hospList');

    let state = {step:0,data:{}};

    function bot(text){
      const div = document.createElement('div'); div.className='msg bot'; div.innerHTML=text;
      messagesEl.appendChild(div); messagesEl.scrollTop = messagesEl.scrollHeight;
    }
    function user(text){
      const div = document.createElement('div'); div.className='msg user'; div.innerText = text;
      messagesEl.appendChild(div); messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function resetChat(){
      messagesEl.innerHTML=''; state={step:0,data:{}};
      bot('Ol√° ‚Äî eu sou o assistente Sa√∫de F√°cil. Est√° ocorrendo uma emerg√™ncia agora? (responda: sim / n√£o)');
    }

    // initial
    resetChat();

    sendBtn.addEventListener('click', ()=>handleInput(userInput.value));
    userInput.addEventListener('keydown', e=>{ if(e.key==='Enter') handleInput(userInput.value); });
    clearBtn.addEventListener('click', resetChat);

    function handleInput(text){
      text = (text||'').trim();
      if(!text) return;
      user(text);
      userInput.value='';
      // simple state machine
      if(state.step===0){
        if(/^(s|sim)/i.test(text)){ state.step=1; bot('Entendido. Primeiro, qual o seu nome (ou do paciente)?'); return; }
        else { state.step=99; bot('Ok. Deseja ver orienta√ß√µes r√°pidas? Digite "orienta√ß√µes" ou "encerrar".'); return; }
      }
      if(state.step===1){ state.data.name = text; state.step=2; bot('Telefone para contato (ou digite pular):'); return; }
      if(state.step===2){ state.data.phone = /pular/i.test(text)? 'N√£o informado' : text; state.step=3; bot('Posso tentar obter sua localiza√ß√£o via GPS ‚Äî permite? (sim / n√£o)'); return; }
      if(state.step===3){
        if(/^(s|sim)/i.test(text)){ attemptGeolocation(); bot('Tentando obter localiza√ß√£o... se n√£o funcionar, voc√™ poder√° digitar manualmente.'); }
        else { state.step=4; bot('Ok. Digite o endere√ßo da ocorr√™ncia (rua, n¬∫, cidade):'); }
        return;
      }
      if(state.step===4){ state.data.address = text; state.step=5; askScenario(); return; }
      if(state.step===5){ const sc = parseScenario(text); if(!sc){ bot('N√£o entendi. Escolha: 1 Acidente, 2 Queda, 3 Engasgo, 4 AVC/Infarto, 5 Sangramento, 6 Outro'); return;} state.data.scenario = sc; state.step=6; askScenarioQuestions(sc); return; }
      if(state.step===6){ handleScenarioAnswers(text); return; }
      if(state.step===20){ if(/^(s|sim|enviar)/i.test(text)){ showSummaryModal(); } else if(/190|ligar/i.test(text)){ window.location.href='tel:190'; } else bot('Comando n√£o reconhecido. Digite "enviar" para enviar resumo ou "190" para ligar.'); return; }
      if(state.step===99){ if(/orienta/i.test(text)){ scrollToSection('orientacoes'); bot('Abrindo orienta√ß√µes...'); } else bot('Ok. Encerrando sess√£o.'); return; }
    }

    function askScenario(){
      bot('Qual o tipo de ocorr√™ncia? Digite n√∫mero: 1 Acidente, 2 Queda, 3 Engasgo, 4 AVC/Infarto, 5 Sangramento, 6 Outro');
      state.step=5;
    }
    function parseScenario(t){
      const n = parseInt(t); if(n>=1 && n<=6) return n;
      const map = {'acidente':1,'queda':2,'engasgo':3,'avc':4,'infarto':4,'sangramento':5,'outro':6};
      for(const k in map) if(t.toLowerCase().includes(k)) return map[k];
      return null;
    }
    function askScenarioQuestions(key){
      if([1,2].includes(key)){ bot('A v√≠tima est√° consciente? (sim / n√£o)'); state.sc_q='conscious'; return; }
      if(key===3){ bot('A v√≠tima est√° tossindo ou sem respirar? (sim / n√£o)'); state.sc_q='choking'; return; }
      if(key===4){ bot('H√° dor no peito, dificuldade para falar ou assimetria facial? (sim / n√£o)'); state.sc_q='cardiac'; return; }
      if(key===5){ bot('H√° sangramento ativo? (sim / n√£o)'); state.sc_q='bleed'; return; }
      bot('Descreva brevemente o que aconteceu:'); state.sc_q='desc'; return;
    }
    function handleScenarioAnswers(text){
      const q = state.sc_q;
      if(q==='conscious'){ state.data.conscious = /^(s|sim)/i.test(text); state.step=7; bot('A v√≠tima est√° respirando? (sim / n√£o)'); return; }
      if(q==='choking'){ state.data.choking = /^(s|sim)/i.test(text); finalizeProtocol(); return; }
      if(q==='cardiac'){ state.data.cardiac = /^(s|sim)/i.test(text); finalizeProtocol(); return; }
      if(q==='bleed'){ state.data.bleed = /^(s|sim)/i.test(text); finalizeProtocol(); return; }
      if(q==='desc'){ state.data.desc = text; finalizeProtocol(); return; }
      if(state.step===7){ state.data.breathing = /^(s|sim)/i.test(text); finalizeProtocol(); return; }
    }

    function finalizeProtocol(){
      const d = state.data; const lines = [];
      lines.push(Solicitante: ${d.name||'‚Äî'});
      lines.push(Contato: ${d.phone||'‚Äî'});
      lines.push(Local: ${d.address || (d.coords ? lat ${d.coords.lat.toFixed(5)}, lon ${d.coords.lon.toFixed(5)} : '‚Äî')});
      const scenarioLabel = {1:'Acidente de Tr√¢nsito',2:'Queda/Trauma',3:'Engasgo',4:'Suspeita AVC/Infarto',5:'Sangramento',6:'Outro'}[d.scenario]||'‚Äî';
      lines.push(Ocorr√™ncia: ${scenarioLabel});

      if(d.scenario==3) lines.push('Orienta√ß√£o: Se consciente, incentive a tosse. Se n√£o respirar, remover obstru√ß√£o e iniciar RCP se necess√°rio.');
      else if(d.scenario==4) lines.push('Orienta√ß√£o: Suspeita de AVC/Infarto: manter em repouso, n√£o oferecer alimentos/√°gua e acionar emerg√™ncia.');
      else if(d.scenario==5) lines.push('Orienta√ß√£o: Comprimir o local do sangramento, elevar o membro e manter press√£o.');
      else if([1,2].includes(d.scenario)) lines.push('Orienta√ß√£o: Avaliar consci√™ncia e respira√ß√£o. Se inconsciente e sem respira√ß√£o, iniciar RCP. Evitar movimentar em trauma suspeito.');
      else lines.push('Orienta√ß√£o: Manter seguran√ßa, sinalizar o local e aguardar equipe de resgate.');

      if(d.conscious===false) lines.push('Sinal cr√≠tico: v√≠tima INCONSCIENTE.');
      if(d.breathing===false) lines.push('Sinal cr√≠tico: v√≠tima N√ÉO RESPIRA. Iniciar RCP.');
      if(d.bleed) lines.push('Sangramento ativo detectado.');
      if(d.choking) lines.push('Engasgo: seguir manobras de desobstru√ß√£o.');

      const protocolText = lines.join('\\n');
      protocolBox.innerText = protocolText;
      bot('Triagem conclu√≠da. Protocolo gerado no painel √† direita. Deseja enviar (digite "enviar") ou ligar para 190?');
      state.step=20;
      state.lastSummary = protocolText;
    }

    // quick buttons
    function quick(text){ user(text); handleInput(text); }

    // copy protocol
    copyProtocol && copyProtocol.addEventListener && copyProtocol.addEventListener('click', ()=>{
      if(!state.lastSummary) { alert('Nenhum protocolo dispon√≠vel.'); return; }
      navigator.clipboard.writeText(state.lastSummary).then(()=> alert('Resumo copiado para a √°rea de transfer√™ncia.'));
    });

    // send to 190 (simulate)
    sendTo190 && sendTo190.addEventListener && sendTo190.addEventListener('click', ()=>{
      if(confirm('Simular envio do resumo para o 190? Em celulares o bot√£o far√° chamada.')){
        // on mobile this will attempt to call
        window.location.href = 'tel:190';
      }
    });

    // LOCATION
    function attemptGeolocationForChat(){
      if(!navigator.geolocation) { locInfo.innerText = 'Geolocaliza√ß√£o n√£o suportada neste navegador.'; return; }
      locInfo.innerText = 'Buscando localiza√ß√£o...';
      navigator.geolocation.getCurrentPosition(pos=>{
        const lat = pos.coords.latitude, lon = pos.coords.longitude;
        state.data.coords = {lat,lon};
        locInfo.innerText = Local obtido: lat ${lat.toFixed(5)}, lon ${lon.toFixed(5)} ‚Äî (usado no protocolo);
      }, err=>{
        locInfo.innerText = 'Falha ao obter localiza√ß√£o: ' + err.message;
      }, {timeout:10000});
    }

    document.getElementById('getLocBtn').addEventListener('click', attemptGeolocationForChat);
    document.getElementById('manualLocBtn').addEventListener('click', ()=>{
      const addr = prompt('Digite o endere√ßo (rua, n√∫mero, bairro, cidade):');
      if(addr){ state.data.address = addr; locInfo.innerText = 'Endere√ßo manual: ' + addr; }
    });

    /* ------------------------------
       Hospitals: open Google Maps search by coordinates
    -------------------------------*/
    function openMapWithQuery(q){
      // open generic google maps search - user can allow location in their browser
      window.open('https://www.google.com/maps/search/' + encodeURIComponent(q), '_blank');
    }

    function getHospitals(){
      hospList.innerHTML = 'Buscando localiza√ß√£o...';
      if(!navigator.geolocation){
        hospList.innerHTML = 'Geolocaliza√ß√£o n√£o suportada. <button onclick="openMapWithQuery(\\'hospitais\\')">Abrir mapa manual</button>';
        return;
      }
      navigator.geolocation.getCurrentPosition(pos=>{
        const lat = pos.coords.latitude, lon = pos.coords.longitude;
        // open google maps search centered on coords
        const gmaps = https://www.google.com/maps/search/hospitais+perto+de+mim/@${lat},${lon},14z;
        const osm = https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=13/${lat}/${lon};
        hospList.innerHTML = '';
        const item = document.createElement('div'); item.className='hosp-item';
        const left = document.createElement('div'); left.innerHTML = <strong>Hospitais pr√≥ximos</strong><div class="small muted">Clique para abrir no mapa</div>;
        const right = document.createElement('div');
        right.innerHTML = `<button class="btn" onclick="window.open('${gmaps}','_blank')">Abrir no Google Maps</button>
                           <button class="btn btn-outline" style="margin-left:6px" onclick="window.open('${osm}','_blank')">OpenStreetMap</button>`;
        item.appendChild(left); item.appendChild(right); hospList.appendChild(item);

        // Try to show three simulated nearby items (names are placeholders)
        const sample = [
          {name:'Hospital Municipal (Exemplo)', dist:'~1.2 km'},
          {name:'UPA Central (Exemplo)', dist:'~2.4 km'},
          {name:'Pronto Socorro (Exemplo)', dist:'~3.0 km'}
        ];
        sample.forEach(s=>{
          const el = document.createElement('div'); el.className='hosp-item';
          el.innerHTML = `<div><strong>${s.name}</strong><div class="small muted">${s.dist}</div></div>
                          <div><button class="btn btn-outline" onclick="openSearch('${s.name.replace(/'/g,'')}','${lat}','${lon}')">Ver no mapa</button></div>`;
          hospList.appendChild(el);
        });

      }, err=>{
        hospList.innerHTML = 'Falha ao obter localiza√ß√£o: ' + err.message + '. <button onclick="openMapWithQuery(\\'hospitais\\')">Abrir mapa manual</button>';
      }, {timeout:10000});
    }

    function openSearch(name,lat,lon){
      const g = https://www.google.com/maps/search/${encodeURIComponent(name)}/@${lat},${lon},14z;
      window.open(g,'_blank');
    }

    /* Accessibility and small improvements */
    // make links in nav smooth
    document.querySelectorAll('nav a').forEach(a=>{
      a.addEventListener('click', e=>{
        e.preventDefault();
        scrollToSection(a.getAttribute('href').slice(1));
      });
    });

    // small fade-in on load
    window.addEventListener('load', ()=> document.querySelectorAll('.fade-in').forEach((el,i)=> el.style.animationDelay = (i*80)+'ms') );

  </script>
</body>
</html>
